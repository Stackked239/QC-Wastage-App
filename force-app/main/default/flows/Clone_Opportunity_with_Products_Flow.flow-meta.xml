<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_to_Collection</name>
        <label>Add to Collection</label>
        <locationX>255</locationX>
        <locationY>562</locationY>
        <assignmentItems>
            <assignToReference>OPLinestoCREATE</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>TemporaryOPLine</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Extract_Lines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Files_to_Collection</name>
        <label>Assign Files to Collection</label>
        <locationX>947</locationX>
        <locationY>903</locationY>
        <assignmentItems>
            <assignToReference>varContentlinkCREATE</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varTempFile</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Files</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Temp_Link</name>
        <label>Assign Temp Link</label>
        <locationX>947</locationX>
        <locationY>759</locationY>
        <assignmentItems>
            <assignToReference>varTempFile.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Files.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varTempFile.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CONewOpportunityId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Files_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Modify the Header ID so that the new record is created (ID = &quot;&quot;) + the other variables overridden</description>
        <name>Update_Header_ID_to_Null</name>
        <label>Update Header ID to Null</label>
        <locationX>740</locationX>
        <locationY>60</locationY>
        <assignmentItems>
            <assignToReference>Collect_Header_from_Existing_Opportunity.Id</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Collect_Header_from_Existing_Opportunity.CloseDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Collect_Header_from_Existing_Opportunity.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Name</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Cloned_Opportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Line_Item_Records</name>
        <label>Update Line Item Records</label>
        <locationX>255</locationX>
        <locationY>381</locationY>
        <assignmentItems>
            <assignToReference>TemporaryOPLine.Color__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Extract_Lines.Color__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TemporaryOPLine.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CONewOpportunityId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TemporaryOPLine.PricebookEntryId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Extract_Lines.PricebookEntryId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TemporaryOPLine.Quantity</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Extract_Lines.Quantity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TemporaryOPLine.UnitPrice</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Extract_Lines.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_to_Collection</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Checking the number of lines of the existing opportunity. Making sure it isn&apos;t 0</description>
        <name>Check_the_Number_of_LInes</name>
        <label>Check the Number of LInes</label>
        <locationX>574</locationX>
        <locationY>477</locationY>
        <defaultConnector>
            <targetReference>Get_Files</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Lines_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Collect_Lines_from_Existing_Opportunity</leftValueReference>
                <operator>NotEqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Extract_Lines</targetReference>
            </connector>
            <label>Lines Exist</label>
        </rules>
    </decisions>
    <decisions>
        <name>Do_Files_exist</name>
        <label>Do Files exist?</label>
        <locationX>576</locationX>
        <locationY>838</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Files_Exist</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Files</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Files</targetReference>
            </connector>
            <label>Files Exist</label>
        </rules>
    </decisions>
    <description>Creating a cloned opportunity with products (Custom)</description>
    <environments>Default</environments>
    <interviewLabel>Clone Opportunity with Products Flow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Clone Opportunity with Products Flow</label>
    <loops>
        <description>Get the opportunity line items one at a time</description>
        <name>Extract_Lines</name>
        <label>Extract Lines</label>
        <locationX>429</locationX>
        <locationY>475</locationY>
        <collectionReference>Collect_Lines_from_Existing_Opportunity</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Update_Line_Item_Records</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CreateOpProducts</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Files</name>
        <label>Loop Files</label>
        <locationX>772</locationX>
        <locationY>836</locationY>
        <collectionReference>Get_Files</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Temp_Link</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_content_Links</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Create new opportunity from existing opportunity</description>
        <name>Create_Cloned_Opportunity</name>
        <label>Create Cloned Opportunity</label>
        <locationX>740</locationX>
        <locationY>283</locationY>
        <assignRecordIdToReference>CONewOpportunityId</assignRecordIdToReference>
        <connector>
            <targetReference>Check_the_Number_of_LInes</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Amount</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Amount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Attention_to_if_applicable__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Attention_to_if_applicable__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>CloseDate</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Colors_on_Back__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Colors_on_Back__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Colors_on_Front__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Colors_on_Front__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Colors_on_Other__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Colors_on_Other__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Final__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Garment_Color_s__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Garment_Color_s__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Monday_Production_Schedule_ID__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <stringValue>Clone-{!Collect_Header_from_Existing_Opportunity.Name}</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Needs_Ordering__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Printer__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Product_Type__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Product_Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Residential_Address__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Residential_Address__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sales_Order_Created__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_City__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Shipping_City__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_Country__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Shipping_Country__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_State__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Shipping_State__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_Street__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Shipping_Street__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_Zip__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Shipping_Zip__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sizes_In__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>StageName</field>
            <value>
                <stringValue>Needs Quoted</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Staged_By__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Tracking_Number__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Transit_Days__c</field>
            <value>
                <elementReference>Collect_Header_from_Existing_Opportunity.Transit_Days__c</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
    </recordCreates>
    <recordCreates>
        <name>Create_content_Links</name>
        <label>Create content Links</label>
        <locationX>772</locationX>
        <locationY>1002</locationY>
        <inputReference>varContentlinkCREATE</inputReference>
    </recordCreates>
    <recordCreates>
        <name>CreateOpProducts</name>
        <label>CreateOpProducts</label>
        <locationX>430</locationX>
        <locationY>698</locationY>
        <connector>
            <targetReference>Get_Files</targetReference>
        </connector>
        <inputReference>OPLinestoCREATE</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Logic to get header from existing opp</description>
        <name>Collect_Header_from_Existing_Opportunity</name>
        <label>Collect Header from Existing Opportunity</label>
        <locationX>568</locationX>
        <locationY>60</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Header_ID_to_Null</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Collect all Line Items from the existing opportunity and load into new OpportunityProduct Line Items</description>
        <name>Collect_Lines_from_Existing_Opportunity</name>
        <label>Collect Lines from Existing Opportunity</label>
        <locationX>422</locationX>
        <locationY>60</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Collect_Header_from_Existing_Opportunity</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>OpportunityLineItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Files</name>
        <label>Get Files</label>
        <locationX>584</locationX>
        <locationY>698</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Do_Files_exist</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>39</locationX>
        <locationY>43</locationY>
        <connector>
            <targetReference>Collect_Lines_from_Existing_Opportunity</targetReference>
        </connector>
    </start>
    <status>Draft</status>
    <variables>
        <description>Clone New Opportunity ID</description>
        <name>CONewOpportunityId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Details for each opportunity line</description>
        <name>LineDetails</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>Contains the entire Opportunity Header</description>
        <name>OldOpportunityHeader</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>OPLinestoCREATE</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>Record set to store the line items</description>
        <name>OpportunityProductLineItems</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>contain the incoming Opportunity ID</description>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>TemporaryOPLine</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>varContentlinkCREATE</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>varTempFile</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
</Flow>
